<!DOCTYPE html>
<html lang="{{ .Site.Language.Lang | default "vi" }}" data-theme="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  {{/* Title */}}
  <title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}</title>
  
  {{/* SEO Meta Tags */}}
  {{ partial "head/seo.html" . }}
  
  {{/* Open Graph */}}
  {{ partial "head/opengraph.html" . }}
  
  {{/* Preload fonts */}}
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  
  {{/* CSS Bundle */}}
  {{ $variables := resources.Get "css/variables.css" }}
  {{ $glass := resources.Get "css/glass.css" }}
  {{ $animations := resources.Get "css/animations.css" }}
  {{ $layout := resources.Get "css/layout.css" }}
  {{ $components := resources.Get "css/components.css" }}
  {{ $home := resources.Get "css/home.css" }}
  {{ $syntax := resources.Get "css/syntax.css" }}
  
  {{ $css := slice $variables $glass $animations $layout $components $home $syntax | resources.Concat "css/bundle.css" }}
  {{ if hugo.IsProduction }}
    {{ $css = $css | minify | fingerprint }}
  {{ end }}
  <link rel="stylesheet" href="{{ $css.RelPermalink }}">
  
  {{/* Favicon */}}
  <link rel="icon" type="image/svg+xml" href="{{ "favicon.svg" | relURL }}">
  <link rel="alternate icon" href="{{ "favicon.ico" | relURL }}">
  
  {{/* RSS Feed */}}
  {{ with .OutputFormats.Get "rss" -}}
    {{ printf `<link rel="%s" type="%s" href="%s" title="%s">` .Rel .MediaType.Type .Permalink $.Site.Title | safeHTML }}
  {{- end }}
  
  {{/* Canonical URL */}}
  <link rel="canonical" href="{{ .Permalink }}">
  
  {{/* Theme Script - Prevent flash */}}
  <script>
    (function() {
      const theme = localStorage.getItem('theme');
      if (theme) {
        document.documentElement.setAttribute('data-theme', theme);
      } else if (window.matchMedia('(prefers-color-scheme: light)').matches) {
        document.documentElement.setAttribute('data-theme', 'light');
      }
    })();
  </script>
  
  {{/* Generator */}}
  {{ hugo.Generator }}
</head>
<body>
  {{/* Skip Link */}}
  <a href="#main-content" class="skip-link">Skip to content</a>
  
  {{/* Interactive Background */}}
  {{ partial "background.html" . }}
  
  {{/* Header */}}
  {{ partial "header.html" . }}
  
  {{/* Main Content */}}
  <main id="main-content" class="main-content">
    {{ block "main" . }}{{ end }}
  </main>
  
  {{/* Footer */}}
  {{ partial "footer.html" . }}
  
  {{/* Fuse.js for Search */}}
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>
  
  {{/* Search Modal */}}
  {{ partial "search.html" . }}
  
  {{/* Scripts */}}
  {{ partial "scripts.html" . }}

  {{/* GSAP & Lenis for Premium Animations */}}
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12/dist/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12/dist/ScrollTrigger.min.js"></script>
  <script src="https://unpkg.com/lenis@1.1.20/dist/lenis.min.js"></script>
  
  <script>
  // Initialize Lenis smooth scroll
  const lenis = new Lenis({
    duration: 1.2,
    easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
    orientation: 'vertical',
    gestureOrientation: 'vertical',
    smoothWheel: true,
  });

  function raf(time) {
    lenis.raf(time);
    requestAnimationFrame(raf);
  }
  requestAnimationFrame(raf);

  // GSAP ScrollTrigger integration
  gsap.registerPlugin(ScrollTrigger);

  // Refresh ScrollTrigger on Lenis scroll
  lenis.on('scroll', ScrollTrigger.update);

  // GSAP animations for reveal elements
  gsap.utils.toArray('.reveal').forEach(function(elem) {
    gsap.fromTo(elem, 
      { y: 50, opacity: 0 },
      {
        y: 0,
        opacity: 1,
        duration: 0.8,
        ease: 'power2.out',
        scrollTrigger: {
          trigger: elem,
          start: 'top 85%',
          toggleActions: 'play none none none'
        }
      }
    );
  });

  // Parallax effect for glass cards
  gsap.utils.toArray('.glass-card').forEach(function(card) {
    gsap.to(card, {
      y: -20,
      ease: 'none',
      scrollTrigger: {
        trigger: card,
        start: 'top bottom',
        end: 'bottom top',
        scrub: 1
      }
    });
  });
  </script>
</body>
</html>





