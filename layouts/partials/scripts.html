{{/* Scripts - Theme toggle, Mobile menu, Animations */}}

<script>
  (function () {
    "use strict";

    // ===== Theme Toggle =====
    const themeToggles = document.querySelectorAll(
      "#theme-toggle, #theme-toggle-mobile"
    );

    function setTheme(theme) {
      document.documentElement.setAttribute("data-theme", theme);
      localStorage.setItem("theme", theme);
    }

    themeToggles.forEach((toggle) => {
      toggle.addEventListener("click", () => {
        const currentTheme =
          document.documentElement.getAttribute("data-theme");
        const newTheme = currentTheme === "dark" ? "light" : "dark";
        setTheme(newTheme);
      });
    });

    // ===== Mobile Menu =====
    const mobileMenuBtn = document.getElementById("mobile-menu-btn");
    const mobileMenu = document.getElementById("mobile-menu");
    const mobileMenuOverlay = document.getElementById("mobile-menu-overlay");

    function openMobileMenu() {
      mobileMenuBtn.classList.add("open");
      mobileMenuBtn.setAttribute("aria-expanded", "true");
      mobileMenu.classList.add("open");
      mobileMenu.setAttribute("aria-hidden", "false");
      mobileMenuOverlay.classList.add("show");
      document.body.style.overflow = "hidden";
    }

    function closeMobileMenu() {
      mobileMenuBtn.classList.remove("open");
      mobileMenuBtn.setAttribute("aria-expanded", "false");
      mobileMenu.classList.remove("open");
      mobileMenu.setAttribute("aria-hidden", "true");
      mobileMenuOverlay.classList.remove("show");
      document.body.style.overflow = "";
    }

    if (mobileMenuBtn) {
      mobileMenuBtn.addEventListener("click", () => {
        const isOpen = mobileMenuBtn.classList.contains("open");
        if (isOpen) {
          closeMobileMenu();
        } else {
          openMobileMenu();
        }
      });
    }

    if (mobileMenuOverlay) {
      mobileMenuOverlay.addEventListener("click", closeMobileMenu);
    }

    // Close on escape key
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        closeMobileMenu();
        // Also close dropdown
        const dropdowns = document.querySelectorAll(
          ".nav-dropdown-wrapper.open"
        );
        dropdowns.forEach((d) => d.classList.remove("open"));
      }
    });

    // ===== Blog Dropdown =====
    const blogDropdownBtn = document.getElementById("blog-dropdown-btn");
    const blogDropdownWrapper = blogDropdownBtn?.closest(
      ".nav-dropdown-wrapper"
    );

    if (blogDropdownBtn && blogDropdownWrapper) {
      blogDropdownBtn.addEventListener("click", (e) => {
        e.preventDefault();
        const isOpen = blogDropdownWrapper.classList.contains("open");

        // Close other dropdowns first
        document.querySelectorAll(".nav-dropdown-wrapper.open").forEach((d) => {
          if (d !== blogDropdownWrapper) d.classList.remove("open");
        });

        if (isOpen) {
          blogDropdownWrapper.classList.remove("open");
          blogDropdownBtn.setAttribute("aria-expanded", "false");
        } else {
          blogDropdownWrapper.classList.add("open");
          blogDropdownBtn.setAttribute("aria-expanded", "true");
        }
      });

      // Close dropdown when clicking outside
      document.addEventListener("click", (e) => {
        if (!blogDropdownWrapper.contains(e.target)) {
          blogDropdownWrapper.classList.remove("open");
          blogDropdownBtn.setAttribute("aria-expanded", "false");
        }
      });
    }

    // ===== Scroll Reveal Animation =====
    const revealElements = document.querySelectorAll(".reveal");

    const revealObserver = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add("visible");
            revealObserver.unobserve(entry.target);
          }
        });
      },
      {
        threshold: 0.1,
        rootMargin: "0px 0px -50px 0px",
      }
    );

    revealElements.forEach((el) => revealObserver.observe(el));

    // ===== Smooth Scroll for anchor links =====
    document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
      anchor.addEventListener("click", function (e) {
        const href = this.getAttribute("href");
        if (href.length > 1) {
          e.preventDefault();
          const target = document.querySelector(href);
          if (target) {
            target.scrollIntoView({ behavior: "smooth" });
          }
        }
      });
    });

    // ===== Progress bar animation on scroll (for skills) =====
    const progressBars = document.querySelectorAll(".progress-bar-fill");

    const progressObserver = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const fill = entry.target;
            const width = fill.getAttribute("data-width");
            if (width) {
              fill.style.width = width;
            }
            progressObserver.unobserve(fill);
          }
        });
      },
      { threshold: 0.5 }
    );

    progressBars.forEach((bar) => {
      // Store the target width and set initial width to 0
      const targetWidth = bar.style.width;
      bar.setAttribute("data-width", targetWidth);
      bar.style.width = "0";
      progressObserver.observe(bar);
    });
  })();
</script>

{{/* Structured Data */}} {{ if .IsPage }} {{ partial "schema/blogposting.html"
. }} {{ end }}
